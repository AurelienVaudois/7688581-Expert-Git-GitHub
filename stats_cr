import pandas as pd

# 1. Définition des colonnes
columns_to_check = [
    "Composition familiale", "Intention de souscription", "Risque attrition", 
    "Potentiel de rapatriement", "Projets Immobiliers & Auto", 
    "Projets Consommation & Loisirs", "Autres"
]

# 2. Statistiques descriptives complètes
# On calcule le nombre de True, le nombre de False et le pourcentage de True
stats_desc = pd.DataFrame({
    'Nombre de True': df_final[columns_to_check].sum(),
    'Nombre de False': len(df_final) - df_final[columns_to_check].sum(),
    'Pourcentage de True (%)': (df_final[columns_to_check].mean() * 100).round(2)
})

print("--- Statistiques Descriptives ---")
print(stats_desc)

# 3. Calcul de la modalité True "Exclusive"
# Pour chaque colonne, on compte les lignes où elle est True ET la somme des autres colonnes est 0
exclusive_counts = {}

for col in columns_to_check:
    # Autres colonnes dans la liste
    other_cols = [c for c in columns_to_check if c != col]
    
    # Condition : la colonne actuelle est True ET toutes les autres sont False
    is_exclusive = (df_final[col] == True) & (df_final[other_cols].sum(axis=1) == 0)
    
    exclusive_counts[col] = is_exclusive.sum()

# Conversion en DataFrame pour une lecture facile
df_exclusive = pd.Series(exclusive_counts, name="Nombre de True Exclusifs").to_frame()

print("\n--- Modalité True Exclusive (uniquement cette colonne à True) ---")
print(df_exclusive)

+++++++++

import pandas as pd

# 1. Configuration des colonnes
columns_to_check = [
    "Composition familiale", "Intention de souscription", "Risque attrition", 
    "Potentiel de rapatriement", "Projets Immobiliers & Auto", 
    "Projets Consommation & Loisirs", "Autres"
]

# 2. Initialisation de la liste pour stocker les résultats
results = []
total_rows = len(df_final)

for col in columns_to_check:
    # Calculs de base
    total_true = df_final[col].sum()
    penetration = (total_true / total_rows) * 100
    
    # Calcul de l'exclusivité (True ici et False ailleurs)
    other_cols = [c for c in columns_to_check if c != col]
    is_exclusive = (df_final[col] == True) & (df_final[other_cols].sum(axis=1) == 0)
    exclusive_volume = is_exclusive.sum()
    
    # Calcul du taux d'exclusivité (par rapport aux porteurs du besoin)
    exclusivity_rate = (exclusive_volume / total_true * 100) if total_true > 0 else 0
    
    # Ajout à la liste
    results.append({
        "Catégorie de Donnée": col,
        "Volume Total (True)": int(total_true),
        "Pénétration (%)": round(penetration, 1),
        "Volume Exclusif": int(exclusive_volume),
        "Taux d'Exclusivité (%)": round(exclusivity_rate, 1)
    })

# 3. Création du DataFrame final
df_ppt = pd.DataFrame(results)

# 4. Affichage du tableau pour copier-coller
print(df_ppt.to_string(index=False))

# Optionnel : Export vers Excel pour un import direct dans PowerPoint
# df_ppt.to_excel("stats_presentation_pptx.xlsx", index=False)

++++++++++++++

import pandas as pd

# 1. Configuration des thématiques détectées
columns_to_check = [
    "Composition familiale", "Intention de souscription", "Risque attrition", 
    "Potentiel de rapatriement", "Projets Immobiliers & Auto", 
    "Projets Consommation & Loisirs", "Autres"
]

results = []
total_cr = len(df_final)

for col in columns_to_check:
    # Nombre de CR où l'intention est détectée
    nb_mention = df_final[col].sum()
    part_cr = (nb_mention / total_cr) * 100
    
    # Détection des CR ne parlant QUE de ce sujet
    other_cols = [c for c in columns_to_check if c != col]
    is_unique = (df_final[col] == True) & (df_final[other_cols].sum(axis=1) == 0)
    nb_unique = is_unique.sum()
    
    # Calcul de la spécificité (si on parle de ce sujet, est-ce le seul ?)
    taux_unicite = (nb_unique / nb_mention * 100) if nb_mention > 0 else 0
    
    results.append({
        "Thématique détectée": col,
        "Nombre de CR": int(nb_mention),
        "% des CR totaux": round(part_cr, 1),
        "Mention Unique (Sujet seul)": int(nb_unique),
        "Taux d'Exclusivité (%)": round(taux_unicite, 1)
    })

# Création du tableau pour PowerPoint
df_ppt = pd.DataFrame(results)

print(f"Analyse basée sur un total de {total_cr} comptes-rendus :")
print(df_ppt.to_string(index=False))

