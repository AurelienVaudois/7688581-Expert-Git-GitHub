### Instructions de sortie (FORMAT JSON STRICT) ###
Tu dois analyser le compte rendu et retourner UNIQUEMENT un objet JSON respectant exactement la structure suivante. Ne rajoute aucun texte avant ou après le JSON.

Structure attendue :
{{
  "presence_kyc": {{
    "composition_foyer": boolean,
    "patrimoine_immobilier": boolean,
    "projets_de_vie": boolean,
    "produits_bancaires": boolean,
    "depenses_habitudes": boolean,
    "preferences_financieres": boolean,
    "infos_professionnelles": boolean,
    "historique_relationnel": boolean,
    "preferences_personnelles": boolean,
    "risques_preoccupations": boolean
  }},
  "metrics": {{
    "nb_opportunites_detectees": integer,
    "score_richesse_donnees": 1-5,
    "interet_commercial": 1-5
  }},
  "details": {{
    "principale_opportunite": "string ou null",
    "concurrence_citee": ["banque1", "banque2"] ou []
  }}
}}

Règles : 
- boolean : true si l'information est présente et exploitable, false sinon.
- score_richesse_donnees : 1 (pauvre) à 5 (très détaillé).
- Si aucune donnée n'est trouvée, retourne l'objet avec des valeurs false, 0 ou null.


#####################

import json
import pandas as pd

# 1. Conversion des chaînes JSON en dictionnaires
df['json_res'] = df['evenement_de_vie'].apply(lambda x: json.loads(x) if isinstance(x, str) else x)

# 2. Extraction des flags de présence (pour les statistiques de complétude)
df_flags = pd.json_normalize(df['json_res'].apply(lambda x: x.get('presence_kyc', {}) if x else {}))

# 3. Calcul de la valeur ajoutée
# Moyenne de complétude par catégorie
stats_completude = df_flags.mean() * 100 

# Score moyen de richesse vs CR manuels (si vous avez un dataset de comparaison)
score_moyen = df['json_res'].apply(lambda x: x.get('metrics', {}).get('score_richesse_donnees', 0) if x else 0).mean()

----------------

### Mission ###
Analyse le compte rendu d'entretien bancaire fourni pour identifier la valeur ajoutée selon trois axes précis.

### Consignes de formatage (JSON STRICT) ###
Réponds uniquement avec un objet JSON respectant cette structure, sans aucun texte superflu :

{{
  "opportunite_commerciale": "Indique ici le produit ou service à proposer (ex: Crédit Auto, Assurance Vie) ou 'Aucun'",
  "mise_en_conformite": "Indique ici une donnée KYC manquante ou à mettre à jour (ex: Changement d'adresse, Profession) ou 'Aucun'",
  "retention_fidelisation": "Indique ici un élément relationnel fort (ex: Passionné de golf, Client insatisfait des frais) ou 'Aucun'"
}}

### Compte rendu à analyser ###
{verbatim}

##########£££££££££££

### MISSION ###
Analyse le compte rendu d'entretien bancaire fourni pour déterminer si des informations de valeur ont été détectées selon les trois définitions suivantes.

### DÉFINITIONS PRÉCISES ###
1. OPPORTUNITE_COMMERCIALE : Détection d'un projet de vie (achat immobilier, changement de véhicule, travaux, retraite) ou d'un besoin financier explicite pouvant mener à la vente d'un produit d'épargne, de crédit ou d'assurance.
2. MISE_EN_CONFORMITE : Détection d'informations réglementaires obligatoires permettant de mettre à jour le dossier KYC du client (changement d'employeur, évolution des revenus, nouvelle situation familiale, ou mention de comptes/crédits détenus dans d'autres banques).
3. RETENTION_FIDELISATION : Détection de signaux relationnels (satisfaction ou mécontentement), de préférences de contact ou de centres d'intérêt personnels (loisirs, passions) permettant de personnaliser et de sécuriser la relation commerciale.

### CONSIGNES DE SORTIE (JSON STRICT) ###
Réponds uniquement avec un objet JSON structuré comme suit. Utilise uniquement les valeurs booléennes true ou false. Ne rédige aucun texte avant ou après.

{{
  "opportunite_commerciale": true/false,
  "mise_en_conformite": true/false,
  "retention_fidelisation": true/false
}}

### COMPTE RENDU À ANALYSER ###
{verbatim}

--------------

### MISSION ###
Analyse le compte rendu d'entretien bancaire fourni pour déterminer si des informations de valeur ont été détectées selon les définitions suivantes.

### DÉFINITIONS PRÉCISES ###
1. OPPORTUNITE_COMMERCIALE : Projet de vie ou besoin financier explicite (achat immo, auto, travaux, retraite, épargne).
2. MISE_EN_CONFORMITE : Donnée réglementaire KYC (changement d'employeur, revenus, situation familiale, comptes dans d'autres banques).
3. RETENTION_FIDELISATION : Signal relationnel (satisfaction, mécontentement, centre d'intérêt, loisirs) pour personnaliser la relation.
4. AUTRE_PERTINENT : Toute information qui n'entre pas dans les cases ci-dessus mais que tu juges utile pour le conseiller bancaire.
5. AUCUNE_INFORMATION : À mettre à true uniquement si absolument aucune information des catégories 1, 2, 3 ou 4 n'est présente.

### CONSIGNES DE SORTIE (JSON STRICT) ###
Réponds uniquement avec un objet JSON. Utilise exclusivement des valeurs booléennes (true/false). Ne rédige aucun texte avant ou après.

{{
  "opportunite_commerciale": true/false,
  "mise_en_conformite": true/false,
  "retention_fidelisation": true/false,
  "autre_pertinent": true/false,
  "aucune_information_trouvee": true/false
}}

### COMPTE RENDU À ANALYSER ###
{verbatim}


